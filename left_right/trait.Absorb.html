<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Types that can incorporate operations of type `O`."><meta name="keywords" content="rust, rustlang, rust-lang, Absorb"><title>Absorb in left_right - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../left_right/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Trait Absorb</h2><div class="sidebar-elems"><div class="block items"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><div class="sidebar-links"><a href="#tymethod.absorb_first">absorb_first</a><a href="#tymethod.sync_with">sync_with</a></div><h3 class="sidebar-title"><a href="#provided-methods">Provided Methods</a></h3><div class="sidebar-links"><a href="#method.absorb_second">absorb_second</a><a href="#method.drop_first">drop_first</a><a href="#method.drop_second">drop_second</a></div><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div><h2 class="location">Other items in<br><a href="index.html">left_right</a></h2><div id="sidebar-vars" data-name="Absorb" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img src="../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img src="../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Trait <a href="index.html">left_right</a>::<wbr><a class="trait" href="#">Absorb</a><button id="copy-path" onclick="copy_path(this)" title="copy path"><img src="../clipboard.svg" width="19" height="18" alt="Copy item import" title="Copy item import to clipboard"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/left_right/lib.rs.html#215-264" title="goto source code">[src]</a></span></h1><div class="docblock type-decl"><pre class="rust trait">pub trait Absorb&lt;O&gt; {
    fn <a href="#tymethod.absorb_first" class="fnname">absorb_first</a>(&amp;mut self, operation: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.reference.html">&amp;mut </a>O, other: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.reference.html">&amp;</a>Self);
<div class="item-spacer"></div>    fn <a href="#tymethod.sync_with" class="fnname">sync_with</a>(&amp;mut self, first: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.reference.html">&amp;</a>Self);

    fn <a href="#method.absorb_second" class="fnname">absorb_second</a>(&amp;mut self, operation: O, other: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.reference.html">&amp;</a>Self) { ... }
<div class="item-spacer"></div>    fn <a href="#method.drop_first" class="fnname">drop_first</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.54.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;Self&gt;) { ... }
<div class="item-spacer"></div>    fn <a href="#method.drop_second" class="fnname">drop_second</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.54.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;Self&gt;) { ... }
}</pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Types that can incorporate operations of type <code>O</code>.</p>
<p>This trait allows <code>left-right</code> to keep the two copies of the underlying data structure (see the
<a href="index.html">crate-level documentation</a>) the same over time. Each write operation to the data
structure is logged as an operation of type <code>O</code> in an <em>operational log</em> (oplog), and is applied
once to each copy of the data.</p>
<p>Implementations should ensure that the absorbption of each <code>O</code> is deterministic. That is, if
two instances of the implementing type are initially equal, and then absorb the same <code>O</code>,
they should remain equal afterwards. If this is not the case, the two copies will drift apart
over time, and hold different values.</p>
<p>The trait provides separate methods for the first and second absorption of each <code>O</code>. For many
implementations, these will be the same (which is why <code>absorb_second</code> defaults to calling
<code>absorb_first</code>), but not all. In particular, some implementations may need to modify the <code>O</code> to
ensure deterministic results when it is applied to the second copy. Or, they may need to
ensure that removed values in the data structure are only dropped when they are removed from
<em>both</em> copies, in case they alias the backing data to save memory.</p>
<p>For the same reason, <code>Absorb</code> allows implementors to define <code>drop_first</code>, which is used to drop
the first of the two copies. In this case, de-duplicating implementations may need to forget
values rather than drop them so that they are not dropped twice when the second copy is
dropped.</p>
</div></details><h2 id="required-methods" class="small-section-header">Required methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.absorb_first" class="method has-srclink"><h4 class="code-header">fn <a href="#tymethod.absorb_first" class="fnname">absorb_first</a>(&amp;mut self, operation: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.reference.html">&amp;mut </a>O, other: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.reference.html">&amp;</a>Self)</h4><a class="srclink" href="../src/left_right/lib.rs.html#221" title="goto source code">[src]</a></div></summary><div class="docblock"><p>Apply <code>O</code> to the first of the two copies.</p>
<p><code>other</code> is a reference to the other copy of the data, which has seen all operations up
until the previous call to <a href="struct.WriteHandle.html#method.publish" title="WriteHandle::publish"><code>WriteHandle::publish</code></a>. That is, <code>other</code> is one “publish
cycle” behind.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.sync_with" class="method has-srclink"><h4 class="code-header">fn <a href="#tymethod.sync_with" class="fnname">sync_with</a>(&amp;mut self, first: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.reference.html">&amp;</a>Self)</h4><a class="srclink" href="../src/left_right/lib.rs.html#263" title="goto source code">[src]</a></div></summary><div class="docblock"><p>Sync the data from <code>first</code> into <code>self</code>.</p>
<p>To improve initialization performance, before the first call to <code>publish</code> changes aren’t
added to the internal oplog, but applied to the first copy directly using <code>absorb_second</code>.
The first <code>publish</code> then calls <code>sync_with</code> instead of <code>absorb_second</code>.</p>
<p><code>sync_with</code> should ensure that <code>self</code>’s state exactly matches that of <code>first</code> after it
returns. Be particularly mindful of non-deterministic implementations of traits that are
often assumed to be deterministic (like <code>Eq</code> and <code>Hash</code>), and of “hidden states” that
subtly affect results like the <code>RandomState</code> of a <code>HashMap</code> which can change iteration
order.</p>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided methods<a href="#provided-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="method.absorb_second" class="method has-srclink"><h4 class="code-header">fn <a href="#method.absorb_second" class="fnname">absorb_second</a>(&amp;mut self, operation: O, other: <a class="primitive" href="https://doc.rust-lang.org/1.54.0/std/primitive.reference.html">&amp;</a>Self)</h4><a class="srclink" href="../src/left_right/lib.rs.html#236-238" title="goto source code">[src]</a></div></summary><div class="docblock"><p>Apply <code>O</code> to the second of the two copies.</p>
<p><code>other</code> is a reference to the other copy of the data, which has seen all operations up to
the call to <a href="struct.WriteHandle.html#method.publish" title="WriteHandle::publish"><code>WriteHandle::publish</code></a> that initially exposed this <code>O</code>. That is, <code>other</code> is
one “publish cycle” ahead.</p>
<p>Note that this method should modify the underlying data in <em>exactly</em> the same way as
<code>O</code> modified <code>other</code>, otherwise the two copies will drift apart. Be particularly mindful of
non-deterministic implementations of traits that are often assumed to be deterministic
(like <code>Eq</code> and <code>Hash</code>), and of “hidden states” that subtly affect results like the
<code>RandomState</code> of a <code>HashMap</code> which can change iteration order.</p>
<p>Defaults to calling <code>absorb_first</code>.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.drop_first" class="method has-srclink"><h4 class="code-header">fn <a href="#method.drop_first" class="fnname">drop_first</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.54.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;Self&gt;)</h4><a class="srclink" href="../src/left_right/lib.rs.html#244" title="goto source code">[src]</a></div></summary><div class="docblock"><p>Drop the first of the two copies.</p>
<p>Defaults to calling <code>Self::drop</code>.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.drop_second" class="method has-srclink"><h4 class="code-header">fn <a href="#method.drop_second" class="fnname">drop_second</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.54.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;Self&gt;)</h4><a class="srclink" href="../src/left_right/lib.rs.html#250" title="goto source code">[src]</a></div></summary><div class="docblock"><p>Drop the second of the two copies.</p>
<p>Defaults to calling <code>Self::drop</code>.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"></div><script type="text/javascript" src="../implementors/left_right/trait.Absorb.js" async></script></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="left_right" data-search-index-js="../search-index.js" data-search-js="../search.js"></div><script src="../main.js"></script></body></html>